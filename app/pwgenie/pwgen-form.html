<!DOCTYPE html>
<html>

<head>
  <title>PWGen: Formatted Password Generator</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function () {
      // Counter for segments IDs
      let segmentsCounter = 2;
      let requestData = "";
      var requestCount = "";
      let requestString = "";

      // Add segments
      $('#addSegmentBtn').click(function () {
        const segmentsId = 'segments' + segmentsCounter;
        const segmentsHtml = `
          <div id="${segmentsId}" class="segments">
            Segment ${segmentsCounter}
            <select class="type">
              <optgroup label="Words">
                <option value="n">Noun</option>
                <option value="v">Verb</option>
                <option value="j">Adjective</option>
                <option value="b">Adverb</option>
                <option value="w">Any word</option>
                <option value="c1">Color</option>
                <option value="c2">Month</option>
                <option value="c3">Day</option>
                <option value="0">Number</option>
              </optgroup>
              <optgroup label="Characters">
                <option value="a">Lowercase Letter</option>
                <option value="A">Uppercase Letter</option>
                <option value="m">Mixed-case Letter</option>
                <option value="s">Symbol/Special Char.</option>
                <option value="d">Digit</option>
                <option value="x">Any Character</option>
                <option value="\">Literal string</option>
              </optgroup>
            </select>
            <select class="case">
              <option value="l">Lower case</option>
              <option value="u">Upper case</option>
              <option value="t">Title case</option>
            </select>
            <input type="text" class="size" placeholder="Enter value 2">
            <button class="removeBtn">Remove Segments</button>
          </div>
        `;
        $('#segmentsContainer').append(segmentsHtml);

        // Increment segments counter
        segmentsCounter++;
      });

      // Remove segments
      $(document).on('click', '.removeBtn', function () {
        $(this).closest('.segments').remove();
      });

      // Send all inputs to API
      $('#btnPWGen').click(function () {
        requestData = ""
        const segments = $('.segments');
        segments.each(function (index) {
          const segments = $(this);
          const typeValue = segments.find('.type').val();
          const caseValue = segments.find('.case').val();
          const sizeValue = segments.find('.size').val();

          requestData += `|${typeValue}${caseValue}${sizeValue}`

          // console.log(requestData);

        });


        console.log(requestData);
        requestCount = $("#count").val();
        requestString = `format=${requestData}&count=${requestCount}`;

        $('#queryURL').val("http://127.0.0.1:8000/pwgen?" + requestString);

        // Make API request with the parameters
        $.ajax({
          url: 'http://127.0.0.1:8000/pwgen/',
          method: 'GET',
          // data: "count=3&format=%7Cjl4%7C%5C-%7Cnt0%7Cs1%7Cd3%7C%5C-%7Cd3%7C%5C-%7Cd4",
          data: requestString,
          contentType: 'application/json',
          success: function (response) {
            // segments.each(function (index) {
            //   const segments = $(this);
            //   segments.find('.result').text('API Response: ' + response[index]);
            // });
            console.log(response.pw_list);
            results = '';
            for (i = 0; i < response.pw_list.length; i++) {
              results += "[" + (i + 1) + "] " + response.pw_list[i] + "<br>";
            }
            $('#results').html(results);
          },
          error: function () {
            segments.each(function () {
              const segments = $(this);
              segments.find('.result').text('Error occurred while calling the API.');
            });
          }
        });
      });
    });
  </script>
  <style>
    body {
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
      font-size: 1.2em;
      background-color: silver;
      font-weight: 900;
    }

    input,
    button,
    select {
      font-size: 1em;
    }

    button {
      color: white;
      background-color: darkolivegreen;
      padding: 10px;
      border-radius: 15px 15px;
      font-weight: 600;
    }

    .segments {
      margin-bottom: 20px;
      border: 1px solid grey;
      border-radius: 50px 10px 10px 50px;
      padding: 25px;
      background-color: darkkhaki;
    }

    div#results {
      font-size: 1.5em;
      font-weight: 600;
      font-family: monospace;
    }
  </style>
</head>

<body>
  <h1>Password Genie</h1>
  <div id="segmentsContainer">
    <div id="segment1" class="segments">
      Segment 1
      <select class="type">
        <optgroup label=" Words">
          <option value="n">Noun</option>
          <option value="v">Verb</option>
          <option value="j">Adjective</option>
          <option value="b">Adverb</option>
          <option value="w">Any word</option>
          <option value="c1">Color</option>
          <option value="c2">Month</option>
          <option value="c3">Day</option>
          <option value="0">Number</option>
        </optgroup>
        <optgroup label="Characters">
          <option value="a">Lowercase Letter</option>
          <option value="A">Uppercase Letter</option>
          <option value="m">Mixed-case Letter</option>
          <option value="s">Symbol/Special Char.</option>
          <option value="d">Digit</option>
          <option value="x">Any Character</option>
          <option value="\">Literal string</option>
        </optgroup>
      </select>
      <select class="case">
        <option value="l">Lower case</option>
        <option value="u">Upper case</option>
        <option value="t">Title case</option>
      </select>
      <input type="text" class="size" placeholder="Enter value">
      <!--button class="removeBtn">Remove Segments</button-->

    </div>
  </div>
  <button id="addSegmentBtn">Add a segment</button><br>
  <hr>
  How many suggestions do you want? <input id="count" size="1" value="3" /><br>
  <button id="btnPWGen">Get passwords with this format</button>
  <hr>
  URL: <input id="queryURL" size="100"></input>
  <br><br>
  Sugestions:<br>
  <div id="results"></div>
</body>

</html>